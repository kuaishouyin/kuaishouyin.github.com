$(function(){var n={winScroll:$.Callbacks("memory"),chooseAnchor:$.Callbacks("memory"),aniStart:$.Callbacks("memory"),aniEnd:$.Callbacks("memory")},t=function(){return{width:$(window).width(),height:$(window).height()}},o=t().height;$(window).resize(function(){o=t().height});var e={headerEl:$(".header"),loginBtnEl:$("[data-type=login-btn]"),init:function(){var n=this;if(n.isShown=!0,"1"!==CONFIG.user.is_login){var t=encodeURIComponent("https://www.kuaishouyin.com"),o=encodeURIComponent("");n.loginInstance=passport.pop.init({apiOpt:{loginType:1,u:"https://www.kuaishouyin.com/jump?uri="+o+"&domain="+t,product:"bp",staticPage:document.location.protocol+"//www.kuaishouyin.com/static/global/html/v3Jump.html"},tangram:!0})}n._action()},_action:function(){var t=this;t.loginBtnEl.click(function(n){n.preventDefault(),t.loginInstance.show()}),n.aniEnd.add(function(n){n.delta>0?t.show():t.hide(),t.headerEl.toggleClass("header-index",n.scrollTop<=o||0===n.sectionIndex)}),n.chooseAnchor.add(function(){0==$(".anchor-hover").attr("data-index")&&t.hide()})},show:function(){var n=this;return n.isShown?n:(n.isShown=!0,void n.headerEl.fadeIn("fast",function(){n.isShown=!0}))},hide:function(){var n=this;return n.isShown?(n.isShown=!1,void n.headerEl.fadeOut("fast",function(){n.isShown=!1})):n}};e.init();var a={init:function(){var n=this;n._action()},_action:function(){var t=function(t){t=t||window.event;var o=0;t.wheelDelta?o=t.wheelDelta:t.detail&&(o=-t.detail);var e=$(document).scrollTop();return o>0&&0==e?!1:(n.winScroll.fire({delta:o,scrollTop:e}),t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1,!1)};document.addEventListener&&document.addEventListener("DOMMouseScroll",t,!1),window.onmousewheel=document.onmousewheel=t}};a.init();var i={navEl:$(".nav"),anchor:$("[data-type=anchor]"),init:function(){var n=this;$(n.anchor.get(0)).addClass("anchor-hover"),n.navEl.css("marginTop",-n.navEl.outerHeight()/2).animate({opacity:1},200),n._action()},_action:function(){var t=this;n.aniStart.add(function(n){t.removeAchorHover(),$(t.anchor[n.sectionIndex]).addClass("anchor-hover")}),t.anchor.click(function(){$(this).hasClass("anchor-hover")||n.chooseAnchor.fire({sectionIndex:$(this).attr("data-index"),delta:!$(".anchor-hover").length||$(".anchor-hover").attr("data-index")>$(this).attr("data-index")?1:-1})})},removeAchorHover:function(){var n=this;n.anchor.removeClass("anchor-hover")}};i.init();var r={init:function(){var n=this;n._action()},_action:function(){$(window).keydown(function(t){if(t.target==document.body||t.target==window){var o=$(document).scrollTop();38==t.which||74==t.which?n.winScroll.fire({delta:1,scrollTop:o}):(40==t.which||75==t.which)&&n.winScroll.fire({delta:-1,scrollTop:o})}}),$(document).keydown(function(t){if(t.target==document.body||t.target==window){var o=$(document).scrollTop();38==t.which||74==t.which?n.winScroll.fire({delta:1,scrollTop:o}):(40==t.which||75==t.which)&&n.winScroll.fire({delta:-1,scrollTop:o})}})}};r.init();var c={startEl:$(".start"),lightWrapEl:$(".light-wrap"),announcementWrapEl:$(".announcement-wrap"),lightFocusEl:$(".light-focus"),lightFocusInnerEl:$(".light-focus-inner"),userInfoWrapEl:$(".user-info-wrap"),mouseEl:$(".mouse"),sectionArray:$("[data-type=section]"),productEl:$(".product"),avatarMaskEl:$(".avatar-mask"),uploadAvatarEl:$(".upload-avatar"),init:function(){var n=this;n.isScroll=!1,n.sectionIndex=0,n.scrollTop=0,n.scrollEl=$("html, body"),n.animation({delta:1,sectionIndex:0,scrollTop:0}),$("#bd").css("paddingBottom",0),n._action().adaptation(),n.lightWrapEl.fadeIn(),n.announcementWrapEl.fadeIn(),n.userInfoWrapEl.fadeIn()},_action:function(){var t=this;return t.lightFocusEl.hover(function(){t.lightFocusInnerEl.removeClass("flipOutY").addClass("light-focus-hover flipInY"),$(".start").removeClass("start").addClass("start")},function(){t.lightFocusInnerEl.removeClass("light-focus-hover flipInY").addClass("flipOutY"),$(".start").removeClass("start").addClass("start")}).click(function(){n.chooseAnchor.fire({sectionIndex:1,delta:-1})}),$(window).resize(function(){t.adaptation()}),$(window).scroll(function(){t.sectionAct($(window).scrollTop()),t.lightFocusInnerEl.removeClass("flipInY flipOutY")}),n.winScroll.add(function(n){t.animation(n)}),n.chooseAnchor.add(function(n){t.animation(n)}),n.aniStart.add(function(n){n.sectionIndex>0&&($(t.sectionArray[n.sectionIndex-1]).find("[data-type=product-inner]").show().addClass("product-inner"),$(t.sectionArray[n.sectionIndex-1]).find("[data-src]").attr("src",function(){return $(this).attr("data-src")}).removeAttr("data-src"))}),t.avatarMaskEl.bind("mouseenter mouseleave",function(){t.uploadAvatarEl.toggleClass("upload-avatar-show")}),t},adaptation:function(){var n=this;return n.productEl.height(o*n.sectionArray.length+458),o>930?(n.userInfoWrapEl.height(250),n.mouseEl.css("marginTop",100)):(n.userInfoWrapEl.height(180),n.mouseEl.css("marginTop",40)),n.lightWrapEl.css("marginTop",Math.min(o-n.lightWrapEl.outerHeight()-n.announcementWrapEl.outerHeight()-n.userInfoWrapEl.outerHeight(),0)),n.startEl.height(o),$.each(n.sectionArray,function(n,t){$(t).css({top:o*(n+1),zIndex:10*(n+1)}),$(t).find(".product-img").css({marginTop:-680,marginBottom:-680}),$(t).find(".detail-wrap").css({marginTop:-680,marginBottom:-680})}),n},animation:function(t){var e=this;1!=e.isScroll&&(e.isScroll=!0,t.sectionIndex?(e.sectionIndex=parseInt(t.sectionIndex),e.scrollTop=o*t.sectionIndex):(t.delta<0&&e.sectionIndex<e.sectionArray.length?e.sectionIndex+=1:t.delta>0&&e.sectionIndex>0&&(e.sectionIndex-=1),e.scrollTop=e.sectionIndex==e.sectionArray.length?o*(e.sectionIndex-1)+458:o*e.sectionIndex),n.aniStart.fire($.extend(t,{sectionIndex:e.sectionIndex})),e.scrollEl.animate({scrollTop:e.scrollTop},600,function(){n.aniEnd.fire($.extend(t,{sectionIndex:e.sectionIndex})),e.isScroll=!1}))},sectionAct:function(n){var t=this;$.each(t.sectionArray,function(e,a){$(a).css({height:function(){return e===t.sectionArray.length-1?458:Math.min(n-o*e,o)}(),top:function(){var a=e+1;return e===t.sectionArray.length-1?Math.max(o*a-n,o-458):e===t.sectionArray.length-2?Math.max(o*a-n,-458):Math.max(o*a-n,0)}()}),$(a).find(".product-img").css({marginTop:function(){return Math.min(n-o*(e+1)-o/2-(680-o)/2,-340)}(),marginBottom:function(){return Math.min(n-o*(e+1)-o/2-(680-o)/2,-340)}()}),$(a).find(".detail-wrap").css({marginTop:function(){return Math.min(n-o*(e+1)-o/2-(680-o)/2,-340)}(),marginBottom:function(){return Math.min(n-o*(e+1)-o/2-(680-o)/2,-340)}()})})}};c.init();var l={announcementContainerEl:$(".announcement-container"),announcementTextEl:$(".announcement-text"),textEl:$(".announcement-text .text"),winSafari:(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(navigator.userAgent)&&!/chrome/i.test(navigator.userAgent)?+(RegExp.$1||RegExp.$2):void 0)&&/win/.test(navigator.platform.toLowerCase()),init:function(){var n=this;if(n.winSafari){var t=$(n.textEl[0]).html();n.announcementContainerEl.html('<marquee align="left" behavior="scroll" direction="left" loop="-1" scrollamount="5" scrolldelay="100" onMouseOut="this.start()" onMouseOver="this.stop()"></marquee>').find("marquee").html(t)}else $(n.textEl[1]).html($(n.textEl[0]).html());n._action()},_action:function(){var t=this,o=function(){t.announcementContainerEl.scrollLeft(t.announcementContainerEl.scrollLeft()>=$(t.textEl[0]).width()?0:t.announcementContainerEl.scrollLeft()+1)},e=null;!t.winSafari&&t.announcementContainerEl.mouseenter(function(){clearInterval(e)}).mouseleave(function(){clearInterval(e),e=setInterval(o,15)}),n.aniEnd.add(function(n){clearInterval(e),0==n.sectionIndex?(e=t.winSafari?null:setInterval(o,15),t.winSafari&&t.announcementContainerEl.find("marquee").get(0).start()):(clearInterval(e),t.winSafari&&t.announcementContainerEl.find("marquee").get(0).stop())})}};l.init()});